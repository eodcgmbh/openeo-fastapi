<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Getting Started - OpenEO FastApi</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Getting Started";
        var mkdocs_page_input_path = "setup.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> OpenEO FastApi
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Getting Started</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#environment-setup">Environment Setup</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#installation">Installation</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#command-line-interface">Command line interface</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#set-the-environment-variables">Set the environment variables</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#deploy-the-application">Deploy the application.</a>
    </li>
    </ul>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">User Guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../guide/registers/">Manipulating endpoints</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../guide/auth/">Add your own auth</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../guide/orms/">Extend the object relational Models</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Reference</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" >openeo_fastapi.api</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../package/api/app/">openeo_fastapi.api.app</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../package/api/models/">openeo_fastapi.api.models</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../package/api/types/">openeo_fastapi.api.types</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" >openeo_fastapi.client</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../package/client/auth/">openeo_fastapi.client.auth</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../package/client/collections/">openeo_fastapi.client.collections</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../package/client/core/">openeo_fastapi.client.core</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../package/client/files/">openeo_fastapi.client.files</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../package/client/jobs/">openeo_fastapi.client.jobs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../package/client/processes/">openeo_fastapi.client.processes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../package/client/register/">openeo_fastapi.client.register</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../package/client/settings/">openeo_fastapi.client.settings</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" >openeo_fastapi.client.psql</a>
    <ul>
                <li class="toctree-l3"><a class="reference internal" href="../package/client/psql/engine/">openeo_fastapi.client.psql.engine</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../package/client/psql/models/">openeo_fastapi.client.psql.models</a>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../package/client/psql/settings/">openeo_fastapi.client.psql.settings</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../package/cli/">openeo_fastapi.cli</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">OpenEO FastApi</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Getting Started</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/eodcgmbh/openeo-fastapi/edit/master/docs/setup.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="getting-started">Getting Started</h1>
<p>Everything on this page is all you need to go from 0 to having your OpenEO Api server running locally.</p>
<h2 id="environment-setup">Environment Setup</h2>
<p>The openeo-fastapi package comes with a couple of assumptions. The first assumption, is the package is used to build a server side application. The second assumption is that the user is able to provide a connection to a psql database. The final assumption, is the user has provided the set of required environment variables which are needed for the application to run.</p>
<p>The following steps will explain how the user can get the application skeleton to run.</p>
<h2 id="installation">Installation</h2>
<p>Prior to installation, configure and activate a virtual environment for your new project, I can recommend using <a href="https://python-poetry.org/docs/basic-usage/">poetry</a> for this. Once the environment is activate continue with installing openeo-fastapi.</p>
<pre><code>pip install openeo-fastapi
</code></pre>
<h2 id="command-line-interface">Command line interface</h2>
<p>The openeo-fastapi CLI can be used to set up a quick source directory for your deployment.</p>
<pre><code>openeo_fastapi new /path/to/source/directory
</code></pre>
<p>The command line interface will create the following directory tree.</p>
<pre><code>src/
    __init__.py
    app.py
    revise.py
    /psql
        alembic.ini
        models.py
        alembic/
            env.py
            README
            script.py.mako
            versions/
</code></pre>
<p>The <strong>app.py</strong> file defines the minimal code to define the FastApi application to deploy the API.</p>
<p>The <strong>revise.py</strong> file defines steps that can be used to generate and apply
alembic revisions to the database deployment. This file is intended to be used after a new release of your deployment, but before your release has been deployed, i.e. as part of an initialization container. This file is optional and can be deleted if you want to complete these steps in a different way.</p>
<p>The <strong>/psql</strong> directory is used for housing the alembic directory to record the alembic revision history and connectivity to the database. All files ( apart from models.py ) are generated from the alembic init command, so refer to the <a href="https://alembic.sqlalchemy.org/en/latest/">alembic docs</a> for more information on those files.</p>
<p>The <strong>/psql/models.py</strong> file defines the basis for importing the orm models from the OpenEO FastApi and defining the metadata class that can then be imported and used in the alembic <em>env.py</em> file.</p>
<p>The <strong>/psql/alembic/env.py</strong> file needs a couple of edits.</p>
<p>Set the main option for the psql connection.</p>
<pre><code>config.set_main_option(
    "sqlalchemy.url",
    f"postgresql://{environ.get('POSTGRES_USER')}:{environ.get('POSTGRES_PASSWORD')}"
    f"@{environ.get('POSTGRESQL_HOST')}:{environ.get('POSTGRESQL_PORT')}"
    f"/{environ.get('POSTGRES_DB')}",
)
</code></pre>
<p>Set the target metadata. In this example, I am importing from the <strong>/psql/models.py</strong> file.</p>
<pre><code>from openeo_api.psql.models import metadata
target_metadata = metadata
</code></pre>
<h2 id="set-the-environment-variables">Set the environment variables</h2>
<p>These variables need to be set in the environment of the deployment. Those marked required need to be set, and those set False, have some default value that only needs to be provided</p>
<table>
<thead>
<tr>
<th>Variable</th>
<th>Description</th>
<th>Required</th>
</tr>
</thead>
<tbody>
<tr>
<td>API_DNS</td>
<td>The domain name hosting the API.</td>
<td>True</td>
</tr>
<tr>
<td>API_TLS</td>
<td>Whether the API http scheme should be http or https.</td>
<td>True</td>
</tr>
<tr>
<td>API_TITLE</td>
<td>The API title to be provided to FastAPI.</td>
<td>True</td>
</tr>
<tr>
<td>API_DESCRIPTION</td>
<td>The API description to be provided to FastAPI.</td>
<td>True</td>
</tr>
<tr>
<td>OPENEO_VERSION</td>
<td>The OpenEO Api specification version supported in this deployment of the API. Defaults to "1.1.0".</td>
<td>False</td>
</tr>
<tr>
<td>OPENEO_PREFIX</td>
<td>The OpenEO prefix to be used when creating the endpoint urls. Defaults to the value of the openeo_version</td>
<td>True</td>
</tr>
<tr>
<td>OIDC_URL</td>
<td>The URL of the OIDC provider used to authenticate tokens against.</td>
<td>True</td>
</tr>
<tr>
<td>OIDC_ORGANISATION</td>
<td>The abbreviation of the OIDC provider's organisation name.</td>
<td>True</td>
</tr>
<tr>
<td>OIDC_POLICIES</td>
<td>The OIDC policies user to check to authorize a user.</td>
<td>False</td>
</tr>
<tr>
<td>STAC_VERSION</td>
<td>The STAC Version that is being supported by this deployments data discovery endpoints. Defaults to "1.0.0".</td>
<td>False</td>
</tr>
<tr>
<td>STAC_API_URL</td>
<td>The STAC URL of the catalogue that the application deployment will proxy to.</td>
<td>True</td>
</tr>
<tr>
<td>STAC_COLLECTIONS_WHITELIST</td>
<td>The collection ids to filter by when proxying to the Stac catalogue.</td>
<td>False</td>
</tr>
<tr>
<td>POSTGRES_USER</td>
<td>The name of the postgres user.</td>
<td>True</td>
</tr>
<tr>
<td>POSTGRES_PASSWORD</td>
<td>The pasword for the postgres user.</td>
<td>True</td>
</tr>
<tr>
<td>POSTGRESQL_HOST</td>
<td>The host the database runs on.</td>
<td>True</td>
</tr>
<tr>
<td>POSTGRESQL_PORT</td>
<td>The post on the host the database is available on.</td>
<td>True</td>
</tr>
<tr>
<td>POSTGRES_DB</td>
<td>The name of the databse being used on the host.</td>
<td>True</td>
</tr>
<tr>
<td>ALEMBIC_DIR</td>
<td>The path to the alembic directory for applying revisions.</td>
<td>True</td>
</tr>
</tbody>
</table>
<h2 id="deploy-the-application">Deploy the application.</h2>
<ol>
<li>
<p>Revise the database.</p>
<pre><code>python -m revise.py
</code></pre>
</li>
<li>
<p>Deploy the uvicorn server</p>
<pre><code>uvicorn openeo_app.main:app --reload
</code></pre>
</li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href=".." class="btn btn-neutral float-left" title="Home"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../guide/registers/" class="btn btn-neutral float-right" title="Manipulating endpoints">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/eodcgmbh/openeo-fastapi" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href=".." style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../guide/registers/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
